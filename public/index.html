<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SabbathTheologyLink - SDA Bible Study</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Beautiful, responsive Bible study web app centered on Seventh-day Adventist theological perspectives">
    <meta name="theme-color" content="#2563eb">
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <!-- Apple PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="SabbathTheologyLink">
    
    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DFBSX9SZHV"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-DFBSX9SZHV');
    </script>
    
    <!-- Firebase SDKs - Universal (works on both Firebase and Vercel) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <!-- Firebase Configuration -->
    <script>
      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyAamVOgH_4fse26cxOURwLSOzeoKFwB8ws",
        authDomain: "sabbaththeologylink.firebaseapp.com",
        projectId: "sabbaththeologylink",
        storageBucket: "sabbaththeologylink.firebasestorage.app",
        messagingSenderId: "710694348415",
        appId: "1:710694348415:web:f9bf6761128501725d414a"
      };
      
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
    </script>

    <style>
      :root {
        --primary-color: #2563eb;
        --primary-dark: #1d4ed8;
        --secondary-color: #f8fafc;
        --text-primary: #1e293b;
        --text-secondary: #64748b;
        --border-color: #e2e8f0;
        --success-color: #059669;
        --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }
      
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background-color: var(--secondary-color);
        color: var(--text-primary);
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      
      .app {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      
      .header {
        background: var(--primary-color);
        color: white;
        padding: 1rem 0;
        text-align: center;
        box-shadow: var(--shadow);
      }
      
      .header h1 {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 0.25rem;
      }
      
      .header p {
        font-size: 0.875rem;
        opacity: 0.9;
      }
      
      .nav-tabs {
        display: flex;
        background: white;
        border-bottom: 1px solid var(--border-color);
        overflow-x: auto;
      }
      
      .nav-tab {
        flex: 1;
        min-width: 80px;
        padding: 1rem;
        text-align: center;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--text-secondary);
        border-bottom: 2px solid transparent;
        transition: all 0.2s ease;
      }
      
      .nav-tab:hover {
        background-color: #f1f5f9;
        color: var(--primary-color);
      }
      
      .nav-tab.active {
        color: var(--primary-color);
        border-bottom-color: var(--primary-color);
      }
      
      .content {
        flex: 1;
        padding: 1.5rem;
        max-width: 1200px;
        margin: 0 auto;
        width: 100%;
      }
      
      .tab-panel {
        display: none;
      }
      
      .tab-panel.active {
        display: block;
        animation: fadeIn 0.3s ease-in-out;
      }
      
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      .card {
        background: white;
        border-radius: 8px;
        padding: 1.5rem;
        box-shadow: var(--shadow);
        margin-bottom: 1rem;
      }
      
      .card h3 {
        font-size: 1.25rem;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
      }
      
      .card p {
        color: var(--text-secondary);
        margin-bottom: 1rem;
      }
      
      .btn {
        display: inline-block;
        padding: 0.75rem 1.5rem;
        background: var(--primary-color);
        color: white;
        text-decoration: none;
        border-radius: 6px;
        font-weight: 500;
        border: none;
        cursor: pointer;
        transition: background-color 0.2s ease;
        font-size: 0.875rem;
      }
      
      .btn:hover {
        background: var(--primary-dark);
      }
      
      .btn-secondary {
        background: var(--border-color);
        color: var(--text-primary);
      }
      
      .btn-secondary:hover {
        background: #d1d5db;
      }
      
      .loading {
        text-align: center;
        padding: 2rem;
        color: var(--text-secondary);
      }
      
      .loading::after {
        content: "";
        display: inline-block;
        width: 20px;
        height: 20px;
        margin-left: 8px;
        border: 2px solid var(--border-color);
        border-radius: 50%;
        border-top-color: var(--primary-color);
        animation: spin 1s ease-in-out infinite;
      }
      
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      
      .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: var(--text-secondary);
      }
      
      .empty-state h3 {
        margin-bottom: 0.5rem;
        color: var(--text-primary);
      }
      
      .auth-form {
        max-width: 400px;
        margin: 2rem auto;
      }
      
      .form-group {
        margin-bottom: 1rem;
      }
      
      .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
      }
      
      .form-input {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        font-size: 1rem;
      }
      
      .form-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      }
      
      /* Quiz Page Styles */
      .quiz-header {
        background: white;
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: var(--shadow);
      }
      
      .quiz-header h2 {
        font-size: 1.75rem;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
      }
      
      .quiz-header p {
        color: var(--text-secondary);
        margin-bottom: 1.5rem;
      }
      
      .filter-controls {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
      }
      
      .filter-select {
        padding: 0.5rem 1rem;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        background: white;
        font-size: 0.875rem;
        min-width: 150px;
      }
      
      .filter-select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      }
      
      .quiz-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 1.5rem;
      }
      
      .quiz-card {
        background: white;
        border-radius: 8px;
        padding: 1.5rem;
        box-shadow: var(--shadow);
        border: 1px solid var(--border-color);
        transition: all 0.2s ease;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        min-height: 180px;
        position: relative;
      }
      
      .quiz-card:hover {
        box-shadow: 0 8px 16px -4px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
      }
      
      .quiz-header-info {
        flex: 1;
      }
      
      .quiz-card h3 {
        font-size: 1.125rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--text-primary);
        line-height: 1.4;
      }
      
      .quiz-stats {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
      }
      
      .question-count,
      .best-score {
        font-size: 0.875rem;
        color: var(--text-secondary);
        background: #f8fafc;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
      }
      
      .quiz-start-btn {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 6px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.2s ease;
        font-size: 0.875rem;
        align-self: flex-start;
      }
      
      .quiz-start-btn:hover {
        background: var(--primary-dark);
      }
      
      .quiz-start-btn.completed {
        background: var(--success-color);
      }
      
      .quiz-start-btn.completed:hover {
        background: #047857;
      }
      
      .quiz-start-btn.in-progress {
        background: #f59e0b;
      }
      
      .quiz-start-btn.in-progress:hover {
        background: #d97706;
      }
      
      /* Quiz Card Icons */
      .quiz-icon {
        position: absolute;
        top: 1rem;
        right: 1rem;
        font-size: 1.5rem;
        opacity: 0.7;
      }
      
      /* Progress Indicators */
      .progress-indicator {
        position: absolute;
        top: 1rem;
        left: 1rem;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.875rem;
        font-weight: bold;
      }
      
      .progress-indicator.completed {
        background: var(--success-color);
        color: white;
      }
      
      .progress-indicator.in-progress {
        background: #f59e0b;
        color: white;
      }
      
      .progress-indicator.not-started {
        background: var(--border-color);
        color: var(--text-secondary);
      }
      
      /* Progress Bar */
      .progress-bar {
        width: 100%;
        height: 4px;
        background: var(--border-color);
        border-radius: 2px;
        margin-top: 0.5rem;
        overflow: hidden;
      }
      
      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--primary-color), var(--success-color));
        transition: width 0.3s ease;
      }
      
      /* Difficulty Badges */
      .difficulty-badge {
        font-size: 0.75rem;
        font-weight: 600;
        padding: 0.25rem 0.5rem;
        border-radius: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      
      .difficulty-badge.beginner {
        background: #dcfce7;
        color: #166534;
      }
      
      .difficulty-badge.intermediate {
        background: #fef3c7;
        color: #92400e;
      }
      
      .difficulty-badge.advanced {
        background: #fecaca;
        color: #991b1b;
      }
      
      /* Pagination Styles */
      .pagination-info {
        text-align: center;
        margin-bottom: 1rem;
        color: var(--text-secondary);
        font-size: 0.875rem;
      }
      
      .pagination-controls {
        text-align: center;
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 1px solid var(--border-color);
      }
      
      .pagination-stats {
        margin-top: 1rem;
        color: var(--text-secondary);
        font-size: 0.875rem;
      }
      
      #load-more-btn {
        margin-bottom: 1rem;
      }
      
      @media (max-width: 768px) {
        .content {
          padding: 1rem;
        }
        
        .nav-tab {
          font-size: 0.75rem;
          padding: 0.75rem 0.5rem;
        }
        
        .card {
          padding: 1rem;
        }
        
        .quiz-header {
          padding: 1rem;
          margin-bottom: 1rem;
        }
        
        .quiz-header h2 {
          font-size: 1.5rem;
        }
        
        .quiz-grid {
          grid-template-columns: 1fr;
          gap: 1rem;
        }
        
        .quiz-card {
          padding: 1rem;
          min-height: auto;
          padding-top: 3rem;
        }
        
        .quiz-icon {
          top: 0.75rem;
          right: 0.75rem;
          font-size: 1.25rem;
        }
        
        .progress-indicator {
          top: 0.75rem;
          left: 0.75rem;
          width: 20px;
          height: 20px;
          font-size: 0.75rem;
        }
        
        .quiz-card h3 {
          font-size: 1rem;
          margin-bottom: 0.75rem;
        }
        
        .quiz-stats {
          margin-bottom: 1rem;
        }
        
        .filter-controls {
          gap: 0.5rem;
        }
        
        .filter-select {
          min-width: 120px;
          flex: 1;
        }
      }
      
      @media (max-width: 480px) {
        .quiz-header {
          padding: 0.75rem;
        }
        
        .quiz-card {
          padding: 0.75rem;
          padding-top: 2.5rem;
        }
        
        .quiz-icon {
          top: 0.5rem;
          right: 0.5rem;
          font-size: 1rem;
        }
        
        .progress-indicator {
          top: 0.5rem;
          left: 0.5rem;
          width: 18px;
          height: 18px;
          font-size: 0.7rem;
        }
        
        .quiz-stats {
          flex-direction: column;
          gap: 0.5rem;
          align-items: flex-start;
        }
        
        .filter-controls {
          flex-direction: column;
        }
        
        .filter-select {
          min-width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="app">
      <!-- Header -->
      <header class="header">
        <h1>SabbathTheologyLink</h1>
        <p>SDA Bible Study & Theology</p>
      </header>
      
      <!-- Navigation Tabs -->
      <nav class="nav-tabs">
        <button class="nav-tab active" data-tab="modules">Modules</button>
        <button class="nav-tab" data-tab="quizzes">Quizzes</button>
        <button class="nav-tab" data-tab="progress">My Progress</button>
        <button class="nav-tab" data-tab="admin">Admin</button>
      </nav>
      
      <!-- Main Content -->
      <main class="content">
        <!-- Modules Tab -->
        <div id="modules" class="tab-panel active">
          <div class="card">
            <h3>Welcome to SabbathTheologyLink</h3>
            <p>Explore Sabbath School lessons, Bible studies, and theological content from a Seventh-day Adventist perspective.</p>
            <div class="empty-state">
              <h3>No modules available yet</h3>
              <p>Check back soon for Sabbath School lessons and Bible study modules!</p>
            </div>
          </div>
        </div>
        
        <!-- Quizzes Tab -->
        <div id="quizzes" class="tab-panel">
          <div class="quiz-header">
            <h2>Bible Study Quizzes</h2>
            <p>Test your understanding with interactive quizzes based on Sabbath School lessons.</p>
            
            <!-- Filter Controls -->
            <div class="filter-controls">
              <select id="difficultyFilter" class="filter-select">
                <option value="">All Levels</option>
                <option value="beginner">Beginner</option>
                <option value="intermediate">Intermediate</option>
                <option value="advanced">Advanced</option>
              </select>
              <select id="topicFilter" class="filter-select">
                <option value="">All Topics</option>
                <option value="joshua">Book of Joshua</option>
                <option value="sabbath">Sabbath Truth</option>
                <option value="sanctuary">Sanctuary</option>
              </select>
            </div>
          </div>
          
          <!-- Pagination Controls -->
          <div class="pagination-info">
            <span>Showing <span id="showing-count">6</span> of <span id="total-count">12</span> quizzes</span>
          </div>
          
          <!-- Quiz Grid -->
          <div class="quiz-grid" id="quiz-grid">
            <!-- Sample quiz cards with icons, progress, and data attributes -->
            <div class="quiz-card" data-difficulty="beginner" data-topic="joshua" data-status="completed">
              <div class="quiz-icon">üìñ</div>
              <div class="progress-indicator completed">‚úì</div>
              <div class="quiz-header-info">
                <h3>Recipe for Success ‚Äî Joshua 1</h3>
                <div class="quiz-stats">
                  <span class="question-count">5 questions</span>
                  <span class="best-score">Best: 95%</span>
                  <span class="difficulty-badge beginner">Beginner</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 100%"></div>
                </div>
              </div>
              <button class="quiz-start-btn completed">Review Quiz</button>
            </div>
            
            <div class="quiz-card" data-difficulty="intermediate" data-topic="sabbath" data-status="in-progress">
              <div class="quiz-icon">üïØÔ∏è</div>
              <div class="progress-indicator in-progress">‚è≥</div>
              <div class="quiz-header-info">
                <h3>The Sabbath Truth Quiz</h3>
                <div class="quiz-stats">
                  <span class="question-count">4 questions</span>
                  <span class="best-score">Best: 75%</span>
                  <span class="difficulty-badge intermediate">Intermediate</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 60%"></div>
                </div>
              </div>
              <button class="quiz-start-btn in-progress">Continue Quiz</button>
            </div>
            
            <div class="quiz-card" data-difficulty="advanced" data-topic="sanctuary" data-status="not-started">
              <div class="quiz-icon">‚õ™</div>
              <div class="progress-indicator not-started">‚óã</div>
              <div class="quiz-header-info">
                <h3>Sanctuary Truth Assessment</h3>
                <div class="quiz-stats">
                  <span class="question-count">4 questions</span>
                  <span class="best-score">Not attempted</span>
                  <span class="difficulty-badge advanced">Advanced</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 0%"></div>
                </div>
              </div>
              <button class="quiz-start-btn">Start Quiz</button>
            </div>
            
            <div class="quiz-card" data-difficulty="beginner" data-topic="joshua" data-status="completed">
              <div class="quiz-icon">üéÅ</div>
              <div class="progress-indicator completed">‚úì</div>
              <div class="quiz-header-info">
                <h3>Surprised by Grace ‚Äî Joshua 2</h3>
                <div class="quiz-stats">
                  <span class="question-count">7 questions</span>
                  <span class="best-score">Best: 88%</span>
                  <span class="difficulty-badge beginner">Beginner</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 100%"></div>
                </div>
              </div>
              <button class="quiz-start-btn completed">Review Quiz</button>
            </div>
            
            <div class="quiz-card" data-difficulty="intermediate" data-topic="joshua" data-status="not-started">
              <div class="quiz-icon">üåä</div>
              <div class="progress-indicator not-started">‚óã</div>
              <div class="quiz-header-info">
                <h3>Crossing the Jordan ‚Äî Joshua 3-4</h3>
                <div class="quiz-stats">
                  <span class="question-count">5 questions</span>
                  <span class="best-score">Not attempted</span>
                  <span class="difficulty-badge intermediate">Intermediate</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 0%"></div>
                </div>
              </div>
              <button class="quiz-start-btn">Start Quiz</button>
            </div>
            
            <div class="quiz-card" data-difficulty="advanced" data-topic="joshua" data-status="in-progress">
              <div class="quiz-icon">‚öîÔ∏è</div>
              <div class="progress-indicator in-progress">‚è≥</div>
              <div class="quiz-header-info">
                <h3>The Commander of the Lord's Army ‚Äî Joshua 5</h3>
                <div class="quiz-stats">
                  <span class="question-count">5 questions</span>
                  <span class="best-score">Best: 40%</span>
                  <span class="difficulty-badge advanced">Advanced</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 30%"></div>
                </div>
              </div>
              <button class="quiz-start-btn in-progress">Continue Quiz</button>
            </div>
          </div>
          
          <!-- Load More Button -->
          <div class="pagination-controls">
            <button id="load-more-btn" class="btn btn-secondary">Load More Quizzes</button>
            <div class="pagination-stats">
              <span>Page 1 of 2</span>
            </div>
          </div>
        </div>
        
        <!-- My Progress Tab -->
        <div id="progress" class="tab-panel">
          <div class="card">
            <h3>Learning Progress</h3>
            <p>Track your Bible study journey and quiz results.</p>
            <div id="auth-section">
              <div class="auth-form">
                <div class="form-group">
                  <label class="form-label">Email</label>
                  <input type="email" id="email" class="form-input" placeholder="Enter your email">
                </div>
                <div class="form-group">
                  <label class="form-label">Password</label>
                  <input type="password" id="password" class="form-input" placeholder="Enter your password">
                </div>
                <button class="btn" onclick="signIn()">Sign In</button>
                <button class="btn btn-secondary" onclick="signUp()">Sign Up</button>
              </div>
            </div>
            <div id="user-progress" style="display: none;">
              <h4>Your Progress</h4>
              <div class="empty-state">
                <p>Complete modules and quizzes to see your progress here.</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Admin Tab -->
        <div id="admin" class="tab-panel">
          <div class="card">
            <h3>Content Management</h3>
            <p>Upload and manage Sabbath School Quarterly content.</p>
            <div class="empty-state">
              <h3>Admin access required</h3>
              <p>Sign in with admin privileges to upload and manage content.</p>
            </div>
          </div>
        </div>
      </main>
    </div>
    
    <div id="loading" class="loading">Initializing Firebase...</div>
    
    <!-- Debug info (remove in production) -->
    <div id="debug-info" style="position: fixed; bottom: 10px; right: 10px; background: #f0f0f0; padding: 5px; font-size: 10px; border-radius: 3px; max-width: 300px; display: none;"></div>

    <script>
      // Global variables
      let auth;
      let firestore;
      let currentUser = null;
      
      // Handle URL-based routing (for direct /admin access)
      function handleRouting() {
        const path = window.location.pathname;
        const hash = window.location.hash;
        
        // Check if accessing /admin directly
        if (path.includes('/admin') || hash === '#admin') {
          switchTab('admin');
        } else if (path.includes('/quizzes') || hash === '#quizzes') {
          switchTab('quizzes');
          setTimeout(initializeQuizFeatures, 100);
        } else if (path.includes('/progress') || hash === '#progress') {
          switchTab('progress');
        } else {
          // Default to modules
          switchTab('modules');
        }
      }
      
      // Initialize Firebase when DOM is loaded
      document.addEventListener('DOMContentLoaded', function() {
        const loadingEl = document.getElementById('loading');
        
        // Add debug info
        const debugEl = document.getElementById('debug-info');
        const hostname = window.location.hostname;
        const isFirebase = hostname.includes('web.app') || hostname.includes('firebaseapp.com');
        const isVercel = hostname.includes('vercel.app');
        
        debugEl.innerHTML = `Host: ${hostname}<br>Firebase: ${isFirebase}<br>Vercel: ${isVercel}<br>Firebase available: ${typeof firebase !== 'undefined'}`;
        debugEl.style.display = 'block';
        
        // Wait a bit for Firebase to fully load
        setTimeout(function() {
          try {
            if (typeof firebase === 'undefined') {
              throw new Error('Firebase SDK not loaded');
            }
            
            // Initialize Firebase services
            auth = firebase.auth();
            firestore = firebase.firestore();
            
            // Set up auth state listener
            auth.onAuthStateChanged(user => {
              currentUser = user;
              updateUIForUser(user);
              debugEl.innerHTML += `<br>Auth: ${user ? 'Signed in as ' + user.email : 'Not signed in'}`;
            });
            
            loadingEl.style.display = 'none';
            console.log('Firebase initialized successfully');
            debugEl.innerHTML += '<br>Status: ‚úÖ Firebase OK';
            
            // Handle initial routing after Firebase is ready
            handleRouting();
          } catch (e) {
            console.error('Error initializing Firebase:', e);
            loadingEl.textContent = 'Error loading Firebase: ' + e.message;
            debugEl.innerHTML += '<br>Status: ‚ùå Error - ' + e.message;
          }
        }, 2000);
      });
      
      // Tab switching functionality
      document.addEventListener('click', function(e) {
        if (e.target.classList.contains('nav-tab')) {
          const tabId = e.target.dataset.tab;
          switchTab(tabId);
          
          // Initialize quiz features when switching to quiz tab
          if (tabId === 'quizzes') {
            setTimeout(initializeQuizFeatures, 100);
          }
        }
        
        // Handle quiz button clicks
        if (e.target.classList.contains('quiz-start-btn')) {
          const quizCard = e.target.closest('.quiz-card');
          const quizTitle = quizCard.querySelector('h3').textContent;
          const action = e.target.textContent.toLowerCase().replace(' ', '_');
          
          trackQuizInteraction(quizTitle, action);
          
          // Prevent actual navigation for demo
          e.preventDefault();
          alert(`Starting: ${quizTitle}\n\nThis would normally navigate to the quiz page.`);
        }
      });
      
      function switchTab(tabId) {
        // Remove active class from all tabs and panels
        document.querySelectorAll('.nav-tab').forEach(tab => {
          tab.classList.remove('active');
        });
        document.querySelectorAll('.tab-panel').forEach(panel => {
          panel.classList.remove('active');
        });
        
        // Add active class to selected tab and panel
        const targetTab = document.querySelector(`[data-tab="${tabId}"]`);
        const targetPanel = document.getElementById(tabId);
        
        if (targetTab && targetPanel) {
          targetTab.classList.add('active');
          targetPanel.classList.add('active');
          
          // Update URL hash for bookmarking
          window.history.replaceState(null, null, '#' + tabId);
        }
      }
      
      // Authentication functions
      function signIn() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        
        if (!email || !password) {
          alert('Please enter email and password');
          return;
        }
        
        auth.signInWithEmailAndPassword(email, password)
          .then(userCredential => {
            console.log('User signed in:', userCredential.user.email);
            clearAuthForm();
          })
          .catch(error => {
            console.error('Sign in error:', error);
            alert('Sign in failed: ' + error.message);
          });
      }
      
      function signUp() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        
        if (!email || !password) {
          alert('Please enter email and password');
          return;
        }
        
        if (password.length < 6) {
          alert('Password must be at least 6 characters');
          return;
        }
        
        auth.createUserWithEmailAndPassword(email, password)
          .then(userCredential => {
            console.log('User created:', userCredential.user.email);
            // Create user document in Firestore
            return firestore.collection('users').doc(userCredential.user.uid).set({
              email: userCredential.user.email,
              name: userCredential.user.email.split('@')[0],
              progress: [],
              createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
          })
          .then(() => {
            clearAuthForm();
          })
          .catch(error => {
            console.error('Sign up error:', error);
            alert('Sign up failed: ' + error.message);
          });
      }
      
      function signOut() {
        auth.signOut().then(() => {
          console.log('User signed out');
        });
      }
      
      function clearAuthForm() {
        document.getElementById('email').value = '';
        document.getElementById('password').value = '';
      }
      
      function updateUIForUser(user) {
        const authSection = document.getElementById('auth-section');
        const userProgress = document.getElementById('user-progress');
        
        if (user) {
          // User is signed in
          authSection.style.display = 'none';
          userProgress.style.display = 'block';
          userProgress.innerHTML = `
            <h4>Welcome, ${user.email}</h4>
            <button class="btn btn-secondary" onclick="signOut()">Sign Out</button>
            <div class="empty-state">
              <p>Complete modules and quizzes to see your progress here.</p>
            </div>
          `;
        } else {
          // User is signed out
          authSection.style.display = 'block';
          userProgress.style.display = 'none';
        }
      }
      
      // Quiz filtering and pagination functionality
      let currentPage = 1;
      const quizzesPerPage = 6;
      let allQuizzes = [];
      let filteredQuizzes = [];
      
      function initializeQuizFeatures() {
        // Get all quiz cards
        allQuizzes = Array.from(document.querySelectorAll('.quiz-card'));
        filteredQuizzes = [...allQuizzes];
        
        // Set up filter listeners
        const difficultyFilter = document.getElementById('difficultyFilter');
        const topicFilter = document.getElementById('topicFilter');
        const loadMoreBtn = document.getElementById('load-more-btn');
        
        if (difficultyFilter) {
          difficultyFilter.addEventListener('change', applyFilters);
        }
        
        if (topicFilter) {
          topicFilter.addEventListener('change', applyFilters);
        }
        
        if (loadMoreBtn) {
          loadMoreBtn.addEventListener('click', loadMoreQuizzes);
        }
        
        // Initial display
        applyFilters();
      }
      
      function applyFilters() {
        const difficultyFilter = document.getElementById('difficultyFilter');
        const topicFilter = document.getElementById('topicFilter');
        
        const selectedDifficulty = difficultyFilter?.value || '';
        const selectedTopic = topicFilter?.value || '';
        
        // Filter quizzes based on selected criteria
        filteredQuizzes = allQuizzes.filter(quiz => {
          const quizDifficulty = quiz.dataset.difficulty || '';
          const quizTopic = quiz.dataset.topic || '';
          
          const matchesDifficulty = !selectedDifficulty || quizDifficulty === selectedDifficulty;
          const matchesTopic = !selectedTopic || quizTopic === selectedTopic;
          
          return matchesDifficulty && matchesTopic;
        });
        
        // Reset to first page when filters change
        currentPage = 1;
        displayQuizzes();
      }
      
      function displayQuizzes() {
        const quizGrid = document.getElementById('quiz-grid');
        const showingCount = document.getElementById('showing-count');
        const totalCount = document.getElementById('total-count');
        const loadMoreBtn = document.getElementById('load-more-btn');
        
        // Hide all quizzes first
        allQuizzes.forEach(quiz => {
          quiz.style.display = 'none';
        });
        
        // Show filtered quizzes up to current page
        const quizzesToShow = filteredQuizzes.slice(0, currentPage * quizzesPerPage);
        quizzesToShow.forEach(quiz => {
          quiz.style.display = 'block';
        });
        
        // Update counters
        if (showingCount) showingCount.textContent = Math.min(quizzesToShow.length, filteredQuizzes.length);
        if (totalCount) totalCount.textContent = filteredQuizzes.length;
        
        // Update load more button
        if (loadMoreBtn) {
          if (quizzesToShow.length >= filteredQuizzes.length) {
            loadMoreBtn.style.display = 'none';
          } else {
            loadMoreBtn.style.display = 'inline-block';
            loadMoreBtn.textContent = `Load More Quizzes (${filteredQuizzes.length - quizzesToShow.length} remaining)`;
          }
        }
        
        // Update pagination stats
        const paginationStats = document.querySelector('.pagination-stats span');
        if (paginationStats) {
          const totalPages = Math.ceil(filteredQuizzes.length / quizzesPerPage);
          const currentPageDisplay = Math.min(currentPage, totalPages);
          paginationStats.textContent = `Page ${currentPageDisplay} of ${totalPages || 1}`;
        }
      }
      
      function loadMoreQuizzes() {
        currentPage++;
        displayQuizzes();
        
        // Add GA4 event tracking
        if (typeof gtag !== 'undefined') {
          gtag('event', 'load_more_quizzes', {
            'custom_parameter': 'page_' + currentPage
          });
        }
      }
      
      // Add quiz interaction tracking
      function trackQuizInteraction(quizTitle, action) {
        if (typeof gtag !== 'undefined') {
          gtag('event', 'quiz_interaction', {
            'quiz_title': quizTitle,
            'action': action
          });
        }
      }
      
      // Service Worker registration for PWA
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('/sw.js')
            .then(registration => {
              console.log('ServiceWorker registration successful');
            })
            .catch(error => {
              console.log('ServiceWorker registration failed');
            });
        });
      }
    </script>
  </body>
</html>
